<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data extraction using inspectEHR • inspectEHR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Data extraction using inspectEHR">
<meta property="og:description" content="inspectEHR">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">inspectEHR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data_quality_evaluation.html">Data Quality Evaluation with inspectEHR</a>
    </li>
    <li>
      <a href="../articles/extract_data.html">Data extraction using inspectEHR</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CC-HIC/inspectEHR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="extract_data_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Data extraction using inspectEHR</h1>
                        <h4 class="author">Edward Palmer</h4>
            
            <h4 class="date">2022-03-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/CC-HIC/inspectEHR/blob/master/vignettes/extract_data.Rmd"><code>vignettes/extract_data.Rmd</code></a></small>
      <div class="hidden name"><code>extract_data.Rmd</code></div>

    </div>

    
    
<p><code>inspectEHR</code> contains a number of helper functions for
direct data extraction. The focus of data extraction in
<code>inspectEHR</code> is to facilitate data quality evaluation. As a
result, the data extraction is optimised for extracting a single data
item or closely related data items. This approach is unlikely to be of
direct use to analyst, who will likely need to extract a large number of
different concepts for a specific patient cohort. In this latter case
use, please refer to the <code>wranglEHR</code> package, which is
optimised for this purpose.</p>
<p>In order to use <code>inspectEHR</code> you first need to install it
with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># If you need inspectEHR</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"DocEd/inspectEHR"</span><span class="op">)</span></code></pre></div>
<p>Now load <code>inspectEHR</code>, establish a database connection and
make the <code>core</code> table. The <code>core</code> table is a
remote query that includes all correct joins, so that you know it is
safe to work with.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CC-HIC/inspectEHR">inspectEHR</a></span><span class="op">)</span>

<span class="co">## Establish a database connection using DBI</span>
<span class="co">## Details omitted here for security</span>
<span class="va">ctn</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">core</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_core.html">make_core</a></span><span class="op">(</span><span class="va">ctn</span><span class="op">)</span></code></pre></div>
<p>Now you can extract whatever data you wish with the
<code>extract</code> function. This is the <code>S3</code> generic that
will apply the correct method to extract a specified CC-HIC event.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Extract Heart Rates</span>
<span class="va">hr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract.html">extract</a></span><span class="op">(</span><span class="va">core</span>, code_name <span class="op">=</span> <span class="st">"NIHR_HIC_ICU_0108"</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">hr</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="15%">
<col width="13%">
<col width="7%">
<col width="26%">
<col width="28%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="right">episode_id</th>
<th align="right">event_id</th>
<th align="left">site</th>
<th align="left">code_name</th>
<th align="left">datetime</th>
<th align="right">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">407676</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0108</td>
<td align="left">2015-12-31 19:46:27</td>
<td align="right">27</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">39713</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0108</td>
<td align="left">2015-12-31 19:46:27</td>
<td align="right">27</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">39714</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0108</td>
<td align="left">2015-12-31 20:46:27</td>
<td align="right">-36</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">39715</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0108</td>
<td align="left">2015-12-31 21:46:27</td>
<td align="right">198</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">39716</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0108</td>
<td align="left">2015-12-31 22:46:27</td>
<td align="right">127</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">39717</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0108</td>
<td align="left">2015-12-31 23:46:27</td>
<td align="right">27</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">39718</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0108</td>
<td align="left">2016-01-01 00:46:27</td>
<td align="right">-31</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">39719</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0108</td>
<td align="left">2016-01-01 01:46:27</td>
<td align="right">-74</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">39720</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0108</td>
<td align="left">2016-01-01 02:46:27</td>
<td align="right">-49</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">39721</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0108</td>
<td align="left">2016-01-01 03:46:27</td>
<td align="right">-159</td>
</tr>
</tbody>
</table>
<p>The event has been extracted into a standardised format, including
other features that are typically useful when evaluating the context of
data quality (e.g. where and when the data originated).</p>
<p>More complex data item extraction is also possible, and requires no
further effort than seen above. We can demonstrate with central venous
pressure (CVP), which contains metadata.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Extract CVP</span>
<span class="va">cvp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract.html">extract</a></span><span class="op">(</span><span class="va">core</span>, code_name <span class="op">=</span> <span class="st">"NIHR_HIC_ICU_0116"</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cvp</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="14%">
<col width="11%">
<col width="6%">
<col width="23%">
<col width="26%">
<col width="7%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="right">episode_id</th>
<th align="right">event_id</th>
<th align="left">site</th>
<th align="left">code_name</th>
<th align="left">datetime</th>
<th align="right">value</th>
<th align="right">meta_1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">407677</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0116</td>
<td align="left">2015-12-31 19:46:27</td>
<td align="right">3.51</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">315907</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0116</td>
<td align="left">2015-12-31 19:46:27</td>
<td align="right">3.51</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">315908</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0116</td>
<td align="left">2015-12-31 20:46:27</td>
<td align="right">0.28</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">315909</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0116</td>
<td align="left">2015-12-31 21:46:27</td>
<td align="right">5.38</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">315910</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0116</td>
<td align="left">2015-12-31 22:46:27</td>
<td align="right">8.01</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">315911</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0116</td>
<td align="left">2015-12-31 23:46:27</td>
<td align="right">10.76</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">315912</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0116</td>
<td align="left">2016-01-01 00:46:27</td>
<td align="right">5.73</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">315913</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0116</td>
<td align="left">2016-01-01 01:46:27</td>
<td align="right">-2.75</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">315914</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0116</td>
<td align="left">2016-01-01 02:46:27</td>
<td align="right">2.06</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">315915</td>
<td align="left">A</td>
<td align="left">NIHR_HIC_ICU_0116</td>
<td align="left">2016-01-01 03:46:27</td>
<td align="right">8.96</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<p>Now you can see an additional column containing the correct metadata.
All column classes are handled automatically, including all metadata and
timestamps for more complex data items. In this way the end user can be
sure that the whole event has been extracted, without referring to the
CC-HIC data model (which is not intuitive to interpret).</p>
<p>The extracted event is tagged with some useful attributes:
<code>code_name</code> and <code>class</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">hr</span>, <span class="st">"code_name"</span><span class="op">)</span>
<span class="co">#&gt; [1] "NIHR_HIC_ICU_0108"</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">hr</span><span class="op">)</span>
<span class="co">#&gt; [1] "integer_2d" "tbl_df"     "tbl"        "data.frame"</span></code></pre></div>
<p>The class encodes the temporally of the event (is it time variant or
not) and the data type (integer, string, real etc.). This is useful in
method dispatch when writing data quality evaluation functions. The
methods currently available for a class can be viewed with
<code><a href="https://rdrr.io/r/utils/methods.html">methods()</a></code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/methods.html">methods</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"integer_1d"</span><span class="op">)</span>
<span class="co">#&gt; [1] evaluate_distribution      evaluate_duplicate        </span>
<span class="co">#&gt; [3] evaluate_local_missingness evaluate_range            </span>
<span class="co">#&gt; see '?methods' for accessing help and source code</span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Edward Palmer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
